var params = {};
if(request.body != null){
	params = request.body;
}else if(request.parameters.body){
	params = request.parameters.body;
} else {
  params = request.parameters;
}
if(typeof params == 'string' && params != null){
  	try{
    	params = JSON.parse(params);   
    }catch(e){
      	return "INVALID OR MISSING PARAMETER";
    }
}

var email = params.email;
var login = params.login;
var password = Math.random().toString(36).slice(-8);
    

var fields = {
    login : login,
    password: password,
    "apsdb.update": "true"
}

var updateUserResult = apsdb.callApi("SaveUser", fields, null);
if(updateUserResult.metadata.status == "success"){
    var body = "Hello, \n Your new password is " + password;
	sendMail(email, "Support", "Password reset", body);    
}else{
    return updateUserResult
}


