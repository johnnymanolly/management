<!DOCTYPE HTML>
<html ng-app="myApp">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="https://www.scriptr.io/themes/scriptr/images/favicon.ico">
    <title>Map</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
    <!-- font awesome.css -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link href="//fonts.googleapis.com/css?family=Josefin+Sans|Montserrat" rel="stylesheet">
    <!-- Map styles -->
    <link rel="stylesheet" href="/UIComponents/dashboard/frontend/components/map/map.css">
    <!-- Adding Angular -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script src="//cdn.rawgit.com/gdi2290/angular-websocket/v1.0.9/angular-websocket.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-cookies.js"></script>
    

    <script src="/UIComponents/wsProvider.js"></script>
     <script src="/UIComponents/httpProvider.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/map/map.js"></script>
    <!--script src="/UIComponents/dashboard/frontend/components/map/mapService.js"></script-->
    
    <!-- Map widget -->
    <script src="//maps.google.com/maps/api/js?key=AIzaSyBcPYghFh_BXz4dDz-TXTHbU2iV3Wbf57I"></script>
    <script src="//rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.js"></script>
    <!-- marker cluster -->
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/js-marker-clusterer/1.0.0/markerclusterer.js"></script!-->
    
    <!-- Used by configuration controller -->
    <script src="/UIComponents/dashboard/frontend/examples/map/simulatorConstants.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/map/markerClusterer.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/list/autocomplete.js"></script>
      
    <link href="/UIComponents/dashboard/frontend/components/toggleSwitch/angular_toggle_switch.css" media="all" rel="stylesheet" type="text/css">  
    <script src="/UIComponents/dashboard/frontend/components/toggleSwitch/angular_toggle_switch.js"></script>
    <script src="/UIComponents/dashboard/frontend/components/toggleSwitch/toggle_switch.js"></script>  
      
      
    
    <script src="/UIComponents/config/scriptrTransport.js"></script>
  </head>
  <script>
    
    	var underscore = angular.module('underscore', []);
     	underscore.factory('_', ['$window', function($window) {		
          	return $window._; // assumes underscore has already been loaded on the page		
      	}]);
    
     	var myApp = angular.module('myApp', ["HttpClient","WsClient", "Map"]);
  		angular.module('myApp').config(wssConfig);
      	angular.module('myApp').config(httpsConfig);
    
      myApp.controller('testCtrl', function($scope, $controller, wsClient, mapConstants, $sce) {
          function findGetParameter(parameterName) {
              var result = null,
                  tmp = [];
              location.search
                  .substr(1)
                  .split("&")
                  .forEach(function (item) {
                  tmp = item.split("=");
                  if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
              });
              return result;
          }  
        var vm = this;  
        var latlong = findGetParameter("location");
        vm.lat = latlong.split(",")[0];
        vm.long = latlong.split(",")[1];
        vm.init = function() {
          	wsClient.onReady.then(function() {});
          	vm.sources = mapConstants.sources;
            vm.icons = mapConstants.infoWindows.icons;
            
            vm.locksData = {
           "5f5de510" : {
              "0" : [ {
                 "id" : {"value": "5f5de510"},
                 "lat" : {"value": vm.lat},
                 "long" :  {"value": vm.long},
                 "location" :  {"value": "Ferdinanda's Home"},
                 "type" : {
                     "value" : "Kwikset / Smart"
                 },
                 "state" : {
                     "value" : "UNLOCKED"
                 },
                 "by" : {
                     "value" : "Essinger"
                 },
                 "company" : {
                     "value" : "scriptr.io"
                 },
                 "batteryLevel" : {
                     "value" : "88.0%"
                 },
                 "tampered" : {
                     "value" : true
                 },
                 "latest" : {"value": false},
                 "timestamp" : {"value": "2017-04-19T12:26:00.000Z"}
              } ],
              "order" : [ "0" ],
              "source" : "simulator"
           }
        };
        }
        	vm.showAssetDashboard = function(id) {
              alert(id)
            }
        });
  </script>
  <body>
     <div ng-controller="testCtrl as vm" ng-init="vm.init()">
        <scriptr-map sources-info="vm.sources" clustered-view="true" detailed-zoom-min="15" path-stroke-opacity="0.5" path-stroke-weight="10" summary-icons="vm.icons" msg-tag="everyone-main-live" assets-data="vm.locksData">
          <div>
            <info-window id="infoWindowTemplate_simulator" template="info_locks.html" max-width="600">
            </info-window>
          </div>
        </scriptr-map>
    </div>
  </body>
</html>
